window.Trails=function(){function t(t){var e,r;if(null!=t)for(r in this.options)this.options[r]=t[r];e=function(t){return function(e){var r;try{return t._handle(e.currentTarget.location.href)}catch(o){return r=o,console.error(r.message)}}}(this),this.options.onLoad&&(window.onload=function(t){return function(){var e;try{return t._handle(window.location)}catch(r){return e=r,console.error(e.message)}}}(this)),window.addEventListener?window.addEventListener("hashchange",e,!1):window.attachEvent?window.attachEvent("onhashchange",e):console.error("This browser is not supported by Trails.")}return t.prototype.options={exceptionOnNotFound:!0,redirectEmptyToRoot:!0,onLoad:!0},t.prototype.routes=[],t.prototype.beforeAllHandlers=[],t.prototype.afterAllHandlers=[],t.prototype.route=function(t,e){var r,o,n,a,i;return t=null!=(i=0===t.indexOf("#"))?i:{path:"#"+t},n=t,r=Array.prototype.slice.call(arguments),t=r.shift(),a=t.match(/:([\w\d]+)/g)||[],a=a.map(function(t){return t.substring(1)}),t=new RegExp("^"+t.replace(/\./,"\\.").replace(/\*/g,"(.+)").replace(/:([\w\d]+)/g,"([^/?]+)")+"$"),o={path:t,originalPath:n,handler:e,paramNames:a},this.routes.push(o)},t.prototype.before=function(t){return this.beforeAllHandlers.push(t)},t.prototype.after=function(t){return this.afterAllHandlers.push(t)},t.prototype.beforeAll=function(){var t,e,r,o,n;for(o=this.beforeAllHandlers,n=[],e=0,r=o.length;r>e;e++)t=o[e],n.push(t());return n},t.prototype.afterAll=function(){var t,e,r,o,n;for(o=this.afterAllHandlers,n=[],e=0,r=o.length;r>e;e++)t=o[e],n.push(t());return n},t.prototype.go=function(t){return window.location.hash=t},t.prototype.allRoutes=function(){return this.routes},t.prototype._handle=function(t){var e,r,o,n,a,i,s,l,h,p,u,c,f;if(l=document.createElement("a"),l.href=t,s=l.hash.replace("#!",""),o=s.indexOf("?")>-1,o&&(u=s.substring(s.indexOf("?")),r=u.slice(1).split("&"),s=s.replace(u,"")),0===s.length){if(!this.options.redirectEmptyToRoot)return!1;s="/"}if(h=this._match(s),!h.handler){if(this.options.exceptionOnNotFound)throw new Error("ONOEZ!  Could not find a matching route for "+s);return!1}if(i={},p=h.path.exec(s),p&&(p.shift(),p.map(decodeURIComponent).forEach(function(t,e){return h.paramNames&&h.paramNames.length>e?i[h.paramNames[e]]=t:t?(i.splat=i.splat||[],i.splat.push(t)):void 0})),o)for(c=0,f=r.length;f>c;c++)a=r[c],n=a.split("="),i[n[0]]=n[1]||"";return e={route:h.originalPath,computed:s,params:i},this.beforeAllHandlers.length>0&&this.beforeAll(e),h.handler(e),this.afterAllHandlers.length>0?this.afterAll(e):void 0},t.prototype._match=function(t){var e,r,o,n,a;for(r={},a=this.routes,o=0,n=a.length;n>o;o++)e=a[o],t.match(e.path||decodeURIComponent(t).match(e.path))&&(r=e);return r},t}();