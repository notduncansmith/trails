window.Trails=function(){function t(t){var e,r;if(null!=t)for(r in this.options)this.options[r]=t[r];e=function(t){return function(e){var r;try{return t._handle(e.currentTarget.location.href)}catch(o){return r=o,console.error(r.message)}}}(this),this.options.onLoad&&(window.onload=function(t){return function(){var e;try{return t._handle(window.location)}catch(r){return e=r,console.error(e.message)}}}(this)),window.addEventListener?window.addEventListener("hashchange",e,!1):window.attachEvent?window.attachEvent("onhashchange",e):console.error("This browser is not supported by Trails.")}return t.prototype.options={exceptionOnNotFound:!0,redirectEmptyToRoot:!0,onLoad:!0},t.prototype.routes=[],t.prototype.beforeAllHandlers=[],t.prototype.afterAllHandlers=[],t.prototype.route=function(t,e){var r,o,n,a;return n=t,r=Array.prototype.slice.call(arguments),t=r.shift(),a=t.match(/:([\w\d]+)/g)||[],a=a.map(function(t){return t.substring(1)}),t=new RegExp("^"+t.replace(/\./,"\\.").replace(/\*/g,"(.+)").replace(/:([\w\d]+)/g,"([^/?]+)")+"$"),o={path:t,originalPath:n,handler:e,paramNames:a},this.routes.push(o)},t.prototype.before=function(t){return this.beforeAllHandlers.push(t)},t.prototype.after=function(t){return this.afterAllHandlers.push(t)},t.prototype.beforeAll=function(){var t,e,r,o,n;for(o=this.beforeAllHandlers,n=[],e=0,r=o.length;r>e;e++)t=o[e],n.push(t());return n},t.prototype.afterAll=function(){var t,e,r,o,n;for(o=this.afterAllHandlers,n=[],e=0,r=o.length;r>e;e++)t=o[e],n.push(t());return n},t.prototype.allRoutes=function(){return this.routes},t.prototype._handle=function(t){var e,r,o,n,a,i;if(n=document.createElement("a"),n.href=t,o=n.hash.replace("#!",""),0===o.length){if(!this.options.redirectEmptyToRoot)return!1;o="/"}if(a=this._match(o),!a.handler){if(this.options.exceptionOnNotFound)throw new Error("ONOEZ!  Could not find a matching route for "+o);return!1}return r={},i=a.path.exec(o),i&&(i.shift(),i.map(decodeURIComponent).forEach(function(t,e){return a.paramNames&&a.paramNames.length>e?r[a.paramNames[e]]=t:t?(r.splat=r.splat||[],r.splat.push(t)):void 0})),e={route:a.originalPath,computed:o,params:r},this.beforeAllHandlers.length>0&&this.beforeAll(e),a.handler(e),this.afterAllHandlers.length>0?this.afterAll(e):void 0},t.prototype._match=function(t){var e,r,o,n,a;for(r={},a=this.routes,o=0,n=a.length;n>o;o++)e=a[o],t.match(e.path||decodeURIComponent(t).match(e.path))&&(r=e);return r},t}();